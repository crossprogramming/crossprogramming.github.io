---
layout: post
title: "Structured logging in ASP.NET Core using Serilog and Seq"
date: 2021-08-16 22:40:07 +0200
tags: [programming, dotnet, dotnet-core, aspnet-core, logging, structured-logging, serilog, seq]
---

- [Context](#context)
- [What is structured logging?](#what-is-structured-logging)
- [What is Serilog?](#what-is-serilog)
  - [Serilog sinks](#serilog-sinks)
  - [Serilog enrichers](#serilog-enrichers)
  - [Serilog properties](#serilog-properties)
  - [Serilog destructuring](#serilog-destructuring)
  - [Configure Serilog](#configure-serilog)
- [What is Seq?](#what-is-seq)
  - [Run Seq using Docker](#run-seq-using-docker)
- [Log application events](#log-application-events)
- [Use message templates](#use-message-templates)
- [Use log scopes](#use-log-scopes)
- [Query application logs](#query-application-logs)
- [Conclusion](#conclusion)

* * *
<!-- markdownlint-disable MD033 -->
<h2 id="context">Context</h2>

Each and every software applications has bugs and it's just a matter of time when the first one will raise its head in production. Due to the critical nature of this environment, one cannot just attach a debugger and try replicating the issue by following the steps mentioned inside the bug report (you do have a bug report per each production issue and the steps needed to replicate it, right?), so usually we will look inside the events generated by the application and its dependencies (you do log events in production, right?). Since we know when the bug was reported, we will filter the events by date and time, but this might not be enough, especially when the amount of such events is huge, so we need to add more filters to eliminate as much data as possible so we only have to look at some tens or hundreds events or so.  
What if we could *query* the data using a specific *language* allowing us to easily express such filters and thus quickly understand what went wrong? What if we could employ such query language to get even more data, not necessarily about an application error, but about the *behavior* of said application?  
  
The purpose of this post is to present an approach of generating application events and search them using the logging mechanism found in ASP.NET Core with the help of [Serilog](https://serilog.net/) and [Seq](https://datalust.co/seq).

<h2 id="what-is-structured-logging">What is structured logging?</h2>

Generating an application event is usually done by writing one or several lines of text to a console, file or database using a library, like [Log4Net](https://logging.apache.org/log4net/) or anything similar to this one. This approach is called *logging*, since we keep a *log* of events. Since the events have been created using plain text, when we need to search for specific data inside the log, we usually resort to the basic search feature offered by the text editor at hand (e.g. Notepad, Notepad++, etc.) or maybe regular expressions. Neither approach is suitable for complex searches - a text editor can only search for words contained inside the events, while writing a custom regex to fetch specific data is not an easy task, plus searching through *all* events means you need to access *all* logs. This is __unstructured logging__, since an event is just a line of text.  
On the other hand, __structured logging__ means generating events with a __specific structure__.  
Using such structure, a software application might offer the means to __index__ and __query__ such events.  
  
ASP.NET Core was built having structure logging in mind with the help of [logging providers](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-5.0#logging-providers), [message templates](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-5.0#log-message-template) and [log scopes](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-5.0#log-scopes).

<h2 id="what-is-serilog">What is Serilog?</h2>

ASP.NET Core provides several built-in logging providers, as documented [here](https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-5.0#built-in-logging-providers), and when I have initially started using this framework, as I was already familiar with Log4Net, I started using it via the [Microsoft.Extensions.Logging.Log4Net.AspNetCore](https://www.nuget.org/packages/Microsoft.Extensions.Logging.Log4Net.AspNetCore/) NuGet package - that was mid 2018. Almost one year later, I stumbled upon [Serilog](https://serilog.net/) and [Seq](https://datalust.co/seq) and I was blown away by this very powerful combination.  

__Serilog__ is a logging framework *with powerful structured event data in mind* (as stated on its home page) which was initially released to NuGet Gallery more than 8 years ago. One uses Serilog to generate events having a given structure and store them in specific places, like a file or database. Serilog uses several concepts, like: [sinks](#serilog-sinks), [enrichers](#serilog-enrichers), [properties](#serilog-properties) and [destructuring](#serilog-destructuring), at the same time offering the means to customize its behavior either via code-based or file-based [configuration sources](#serilog-configuration).

<h3 id="serilog-sinks">Serilog sinks</h3>

TODO

<h3 id="serilog-enrichers">Serilog enrichers</h3>

TODO

<h3 id="serilog-properties">Serilog properties</h3>

TODO

<h3 id="serilog-destructuring">Serilog destructuring</h3>

TODO

<h3 id="configure-serilog">Configure Serilog</h3>

TODO

<h2 id="what-is-seq">What is Seq?</h2>
Being able to generate events with a given structure is not enough when you need to extract relevant data out of them - one needs the means to index and query such data.  
__Seq__ *is the intelligent search, analysis, and alerting server built specifically for modern structured log data* (as stated on its home page)

<h3 id="run-seq-using-docker">Run Seq using Docker</h3>

TODO

<h2 id="log-application-events">Log application events</h2>

TODO

<h2 id="use-message-templates">Use message templates</h2>

TODO

<h2 id="use-log-scopes">Use log scopes</h2>

TODO

<h2 id="query-application-logs">Query application logs</h2>

TODO

<h2 id="conclusion">Conclusion</h2>

TODO
